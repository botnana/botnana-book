<!DOCTYPE HTML>
<html lang="zh-TW" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>EtherCAT Drive 指令集 - Botnana Book</title>


        <!-- Custom HTML head -->

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> 簡介</a></li><li class="chapter-item expanded "><a href="hardware.html"><strong aria-hidden="true">2.</strong> 硬體規格</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="botnana-a2.html"><strong aria-hidden="true">2.1.</strong> Botnana BN-A2A</a></li><li class="chapter-item expanded "><a href="botnana-bn-j4a.html"><strong aria-hidden="true">2.2.</strong> Botnana BN-J4A</a></li></ol></li><li class="chapter-item expanded "><a href="software.html"><strong aria-hidden="true">3.</strong> 軟體規格</a></li><li class="chapter-item expanded "><a href="roadmap.html"><strong aria-hidden="true">4.</strong> Roadmap</a></li><li class="chapter-item expanded "><a href="tutorial.html"><strong aria-hidden="true">5.</strong> 入門教學</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="botnana-a2-tutorial.html"><strong aria-hidden="true">5.1.</strong> Botnana A2 入門</a></li><li class="chapter-item expanded "><a href="botnana-control-tutorial.html"><strong aria-hidden="true">5.2.</strong> Botnana Control 入門</a></li></ol></li><li class="chapter-item expanded "><a href="configuration-file.html"><strong aria-hidden="true">6.</strong> 設定檔</a></li><li class="chapter-item expanded "><a href="programming.html"><strong aria-hidden="true">7.</strong> 程式開發界面</a></li><li class="chapter-item expanded "><a href="json-api.html"><strong aria-hidden="true">8.</strong> JSON API</a></li><li class="chapter-item expanded "><a href="real-time-script-api.html"><strong aria-hidden="true">9.</strong> Real-time Script API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="host-primitives.html"><strong aria-hidden="true">9.1.</strong> Botnana 基本指令集</a></li><li class="chapter-item expanded "><a href="ethercat-primitives.html"><strong aria-hidden="true">9.2.</strong> EtherCAT 指令集</a></li><li class="chapter-item expanded "><a href="ethercat-drive-primitives.html" class="active"><strong aria-hidden="true">9.3.</strong> EtherCAT Drive 指令集</a></li><li class="chapter-item expanded "><a href="ethercat-io-primitives.html"><strong aria-hidden="true">9.4.</strong> EtherCAT IO 指令集</a></li><li class="chapter-item expanded "><a href="ethercat-uart-primitives.html"><strong aria-hidden="true">9.5.</strong> EtherCAT UART 指令集</a></li><li class="chapter-item expanded "><a href="ethercat-encoder-primitives.html"><strong aria-hidden="true">9.6.</strong> EtherCAT Encoder 指令集</a></li><li class="chapter-item expanded "><a href="ethercat-gateway-primitives.html"><strong aria-hidden="true">9.7.</strong> EtherCAT Gateway 指令集</a></li><li class="chapter-item expanded "><a href="axis-group.html"><strong aria-hidden="true">9.8.</strong> 軸組 Axis Group 指令集</a></li><li class="chapter-item expanded "><a href="sfc.html"><strong aria-hidden="true">9.9.</strong> 狀態流程圖 Sequential Function Chart (SFC)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="sfc-example/servo-on-off.html"><strong aria-hidden="true">9.9.1.</strong> Servo On/OFF</a></li><li class="chapter-item expanded "><a href="sfc-example/motion-state.html"><strong aria-hidden="true">9.9.2.</strong> Motion State</a></li><li class="chapter-item expanded "><a href="sfc-example/axes-homing.html"><strong aria-hidden="true">9.9.3.</strong> Homing State</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="known-working-hardware.html"><strong aria-hidden="true">10.</strong> 支援的硬體清單</a></li><li class="chapter-item expanded "><a href="update-software.html"><strong aria-hidden="true">11.</strong> 軟體更新</a></li><li class="chapter-item expanded "><a href="faq.html"><strong aria-hidden="true">12.</strong> 常見問題</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="faq/network.html"><strong aria-hidden="true">12.1.</strong> 網路設定</a></li><li class="chapter-item expanded "><a href="faq/gadget.html"><strong aria-hidden="true">12.2.</strong> USB連線IP設定</a></li><li class="chapter-item expanded "><a href="faq/windows7_rndis.html"><strong aria-hidden="true">12.3.</strong> Windows 7 RNDIS 驅動程式安裝</a></li><li class="chapter-item expanded "><a href="faq/windows10_rndis.html"><strong aria-hidden="true">12.4.</strong> Windows 10 RNDIS 驅動程式安裝</a></li><li class="chapter-item expanded "><a href="faq/win10_permission.html"><strong aria-hidden="true">12.5.</strong> Windows 10 檔案權限修改</a></li><li class="chapter-item expanded "><a href="faq/mount.html"><strong aria-hidden="true">12.6.</strong> 磁碟掛載 Mount</a></li><li class="chapter-item expanded "><a href="faq/manual_install_deb/manual_install_deb.html"><strong aria-hidden="true">12.7.</strong> 手動安裝 Botnana Control 更新檔</a></li><li class="spacer"></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Botnana Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h3 id="ethercat-drive-指令集"><a class="header" href="#ethercat-drive-指令集">EtherCAT Drive 指令集</a></h3>
<p>EtherCAT 驅動器通常都會符合 CiA 402 規範，此規範定義了驅動器的操作模式與介面。實際上驅動器並不會實現所有 CiA 402 規範提到的所有功能，在選用驅動器時還是要留意。</p>
<p>目前 Botnana Control 支援以下幾種驅動器的運動模式：</p>
<ul>
<li>位置控制模式 PP (Profile Position Mode）</li>
<li>速度控制模式 PV (Profile Velocity Mode）</li>
<li>原點復歸模式 HM (Homing mode)</li>
<li>扭力控制模式 TQ (Profile  Torque Mode)</li>
<li>週期同步位置模式 CSP (Cyclic Sync Position Mode)</li>
<li>週期同步速度模式 CSV (Cyclic Sync Velocity Mode)</li>
<li>週期同步扭力模式 CST (Cyclic Sync Torque Mode)</li>
</ul>
<p>就應用面來看週期同步模式適合用來做多軸同動或是特殊的軌跡規劃。</p>
<p><strong>位置模式方塊圖：</strong></p>
<pre><code>               +--------+
               | +----&gt; |----------------------- +
               | |CSP   |                        |
               | |      |      +-------------+   v    +-----------+
Target   -----&gt;|-+----&gt; |-----&gt;| Position    |--&gt;o---&gt;|  Position |----&gt; Control
Position       |  PP    |      | Trajectory  |        |  Control  |      Effect
               |        |      | Generation  |        |           |
               +--------+      +-------------+        +-----------+
              Mode Seletor

</code></pre>
<p><strong>速度模式方塊圖：</strong></p>
<pre><code>               +--------+
               | +----&gt; |----------------------- +
               | |CSV   |                        |
               | |      |      +-------------+   v    +-----------+
Target   -----&gt;|-+----&gt; |-----&gt;| Velocity    |--&gt;o---&gt;|  Velocity |----&gt; Control
Velocity       |  PV    |      | Trajectory  |        |  Control  |      Effect
               |        |      | Generation  |        |           |
               +--------+      +-------------+        +-----------+
              Mode Seletor

</code></pre>
<p><strong>扭力模式方塊圖：</strong></p>
<pre><code>               +--------+
               | +----&gt; |----------------------- +
               | |CST   |                        |
               | |      |      +-------------+   v    +-----------+
Target   -----&gt;|-+----&gt; |-----&gt;| Torque      |--&gt;o---&gt;|  Torque   |----&gt; Control
Torque         |  TQ    |      | Trajectory  |        |  Control  |      Effect
               |        |      | Generation  |        |           |
               +--------+      +-------------+        +-----------+
              Mode Seletor

</code></pre>
<p><strong>原點復歸模式</strong>：以下是幾種常見的復歸方法，每一種驅動器必須依該廠家的所支援的方法為準。</p>
<ul>
<li>Method 1 and 2 : Homing on the limit switch and index pulse</li>
</ul>
<p>依據所選擇的負/正方向，原點位置在遇到 limit switch 反轉後最靠近的 index pulse。</p>
<pre><code>++                    ++                     ++
||--------------------||---------------------||
||--------------------||---------------------||
++                    ++                     ++
                       |
     +-----------------|
     |.     .          |
     +-----(1)-&gt;
      .     .
      .     |         |       |    Index Pulse
------------+---------+-------+----------------
------+
      |                    Negativ Limit Switch
      +----------------------------------------
                       |             .   .
                       |-------------------+
                       |             .   . |
                                  &lt;-(2)----+
                                     .   .
                                     .   .
Index Pulse            |       |     |   .
-----------------------+-------+-----+----------
                                         +------
Positive Limit Switch                    |
-----------------------------------------+
</code></pre>
<ul>
<li>Methods 3 to 6: Homing on the home switch and index pulse</li>
</ul>
<p>依據所選擇的負/正方向與方法，原點位置在遇到 home switch 後最靠近的 index pulse。</p>
<pre><code>++                                           ++
||-------------------------------------------||
||-------------------------------------------||
++                                           ++
    |
    |------------------+
    |            .    .|   .
              &lt;-(3)----+   .
                 .    .    .             |
              &lt;-(3)----------------------|
                 .    .    .             |
    |            .    .    .
    |---------------------(4)-&gt;
    |            .    .    .             |
                 .   +-------------------|
                 .   |.    .             |
                 .   +----(4)-&gt;
                 .    .    .
Index Pulse      |    .    |
-----------------+----------------------------
                      +-----------------------
Home Switch           |
----------------------+
     |             .   .    .
     |---------------------(5)-&gt;
     |             .   .    .            |
                   .  +------------------|
                   .  |.    .            |
                   .  +----(5)-&gt;
     |             .   .    .
     |------------------+   .
     |             .   .|   .
                &lt;-(6)--.+   .
                   .   .    .              |
                &lt;-(6)----------------------|
                   .   .    .              |
Index Pulse        |   .    |
-------------------+--------+--------------------
Home Switch            .
-----------------------+
                       |
                       +-------------------------
</code></pre>
<ul>
<li>Methods 7 to 10: Homing on positive limit switch, home switch and index pulse</li>
</ul>
<p>與 Methods 3 to 6 的方法類似，遇到正極限開關後反轉，會依其設定方式尋找 index pulse。</p>
<pre><code>++                                                                ++
||----------------------------------------------------------------||
||----------------------------------------------------------------||
++                                                                ++
    |           .     .      .           .      .         .
    |--------------------------------------------+------(10)-&gt;
    |           .     .      .           .      .|        .
    |------------------+----(8)-&gt;     &lt;-(9)------+        .
                .     .|     .           .      .         .
             &lt;-(7)-----+     .           .      .         .
                .     .      .     |     .      .         .
             &lt;-(7)---+-------------+-------------+------(10)-&gt;
                .    |.      .     |     .      .|        .
                .    +------(8)-&gt;     &lt;-(9)------+        .
                .     .      .           .      .       | .  .
                .     .      .           .      .       |-----+
                .     .      .           .      .       | .  .|
                .     .      .           .      .         .  .|
             &lt;-(7)---+----------------------------------------+
                .    |.      .           .      .         .  .|
                .    +------(8)-&gt;     &lt;-(9)----+--------------+
                .     .      .           .     |.         .  .
                .     .      .           .     +--------(10)-&gt;
                .     .      .           .      .         .  .
Index Pulse     |     .      |           |      .         |  .
-------------------------------------------------------------------
                      +-------------------------+            .
Home Switch           |                         |            .
----------------------+                         +------------------
                                                             +-----
Positive Limit Switch                                        |
-------------------------------------------------------------+
</code></pre>
<ul>
<li>Methods 11 to 14: Homing on negative limit switch, home switch and index pulse</li>
</ul>
<p>與 Methods 3 to 6 的方法類似，遇到負極限開關後反轉，會依其設定方式尋找 index pulse。</p>
<pre><code>++                                                                       ++
||-----------------------------------------------------------------------||
||-----------------------------------------------------------------------||
++                                                                       ++
                  .      .     .           .      .      .         |
              &lt;-(14)----+-------------------------.----------------|
                  .     |.     .           .      .      .         |
                  .     +-----(13)-&gt;   &lt;-(12)---+-.----------------|
                  .      .     .           .    | .      .         |
                  .      .     .           .    +-.-----(11)-&gt;
                  .      .     .     |     .      .      .
              &lt;-(14)----+------------+-------------+----(11)-&gt;
                  .     |.     .     |     .      .|     .
                  .     +-----(13)-&gt;   &lt;-(12)------+     .
       .     |    .      .     .           .      .      .
      +------|    .      .     .           .      .      .
      |.     |    .      .     .           .      .      .
      |.          .      .     .           .      .      .
      +--------------------------------------------+----(11)-&gt;
      |.          .      .     .           .      .|     .
      +-------------------+---(13)-&gt;   &lt;-(12)------+     .
       .          .      .|    .           .      .      .
       .      &lt;-(14)------+    .           .      .      .
       .          .      .     .           .      .      .
Index Pulse       |      .     |           |      .      |
---------------------------------------------------------------------
       .                 +------------------------+
Home Switch              |                        |
+------------------------+                        +------------------
       +-------------------------------------------------------------
       |                                      Negative Limit Switch
+------+
</code></pre>
<ul>
<li>Methods 17 and 18: Homing on limit switch without an index pulse</li>
</ul>
<p>依據所選擇的負/正方向，原點位置在 limit switch 上。</p>
<pre><code> ++                 ++                        ++
 ||-----------------||------------------------||
 ||-----------------||------------------------||
 ++                 ++                        ++
       .             |
    +----------------|
    |  .             |
    +-(17)-&gt;
       .
 ------+
       |                    Negative Limit Switch
       +-----------------------------------------
                      |                   .
                      |-----------------------+
                      |                   .   |
                                       &lt;-(18)-+
                                          .
                                          +------
Positive Limit Switch                     |
------------------------------------------+
</code></pre>
<ul>
<li>Methods 19 to 22: Homing on home switch without an index pulse</li>
</ul>
<p>依據所選擇的負/正方向與方式，原點位置在 home switch 上。</p>
<pre><code> ++    ++                                     ++
 ||----||-------------------------------------||
 ||----||-------------------------------------||
 ++    ++                 .                   ++
       |                  .
       |-------------------------+
       |                  .      |
                      &lt;-(19)-----+
                          .            |
                      &lt;-(19)-----------|
       |                  .            |
       |----------------(20)-&gt;
       |                  .            |
                  +--------------------|
                  |       .            |
                  +-----(20)-&gt;
                          .
                          +--------------------
Home Switch               |
--------------------------+

 ++    ++                                     ++
 ||----||-------------------------------------||
 ||----||-------------------------------------||
 ++    ++                 .                   ++
       |                  .
       |----------------(21)-&gt;
       |                  .            |
                  +--------------------|
                  |       .            |
                  +-----(21)-&gt;
       |                  .
       |-------------------------+
       |                  .      |
                      &lt;-(22)-----+     |
                      &lt;-(22)-----------|
                          .            |
Home Switch               .
--------------------------+
                          |
                          +--------------------
</code></pre>
<ul>
<li>Methods 33 and 34: Homing on the index pulse</li>
</ul>
<p>依據所選擇的負/正方向，原點位置在最靠近目前位置的 index pulse。</p>
<pre><code>++                   ++                      ++
||-------------------||----------------------||
||-------------------||----------------------||
++                   ++                      ++
                .     |     .
           &lt;--(33)----|     .
                .     |---(34)---&gt;
                .     |     .
 Index Pulse    .           .
    |           |           |            |
 -------------------------------------------------
</code></pre>
<ul>
<li>Methods 35 and 37: Homing on current position</li>
</ul>
<p>原點位置就在目前位置。</p>
<pre><code>++                   ++                      ++
||-------------------||----------------------||
||-------------------||----------------------||
++                   ++                      ++
                    (35)
                    (37)
</code></pre>
<p><strong>驅動器運行狀態</strong></p>
<pre><code>               +-------+
--------------&gt;| FSA   +--------------&gt;
Control Word   |       |   Status Word
(0x6040)       +-------+   (0x6041)
</code></pre>
<p>FSA (Finite States Automaton) of PDS (Power Drive System)</p>
<pre><code>             Start
               |
               |
               V 0
        +-------------------+
        | Not Ready to      |
        | switch on         |
        | (Not initialized) |
        +-------------------+
               |
               |
               V 1
 +------------------------------+       +-----------+
 |         Switch on            | 15    |   Fault   |
 |         Disabled             |&lt;------|           |
 |  (Initialization completed)  |       |  (Alarm)  |
 +------------------------------+       +-----------+
  ^ 9        |   ^ 7   ^ 10   ^ 12            ^ 14
  |          |   |     |      |               |
  |          v 2 |     |      |               |
  |  +---------------+ |      |               |
  |  |  Ready to     | |      |               |
  |  |  Switch on    | |      |               |
  |  | (Main circuit | |      |               |
  |  |  power off )  | |      |               |
  |  +---------------+ |      |               |
  |    ^ 8   |   ^ 6   |      |               |
  |    |     |   |     |      |               |
  |    |     V 3 |     |      |               |
  |    | +-------------+----+ |        +------+-----------+
  |    | |   Switched on    | |        |  Fault reaction  |
  |    | |                  | |        |     active       |
  |    | |  (Servo ready)   | |        | (Deceleration    |
  |    | +------------------+ |        |  processing)     |
  |    |     |   ^ 5          |        +------------------+
  |    |     |   |            |               ^
  |    |     v 4 |            |               | 13
+-------------------+   11 +---------------+  |
|     Operation     |-----&gt;|Quick stop     |  |
|     Enabled       |&lt;-----|active         |  |
|                   | 16   | (Deceleration |  |
|     (Servo on)    |      |  processing)  |  |
+-------------------+      +---------------+  |
                                              Error Occurs 
</code></pre>
<p>FSA Transition</p>
<table><thead><tr><th>No</th><th>FSA Transition</th></tr></thead><tbody>
<tr><td>0</td><td>Auto skip</td></tr>
<tr><td>1</td><td>Auto skip</td></tr>
<tr><td>2</td><td>[Shutdown]</td></tr>
<tr><td>3</td><td>[Switch On]</td></tr>
<tr><td>4</td><td>[Enable operation]</td></tr>
<tr><td>5</td><td>[Disable operation]</td></tr>
<tr><td>6</td><td>[Shutdown]</td></tr>
<tr><td>7</td><td>[Disable voltage]</td></tr>
<tr><td>8</td><td>[Shutdown]</td></tr>
<tr><td>9</td><td>[Disable voltage]</td></tr>
<tr><td>10</td><td>[Disable voltage]</td></tr>
<tr><td>11</td><td>[Quick stop]</td></tr>
<tr><td>12</td><td>[Disable voltage]</td></tr>
<tr><td>13</td><td>Error Occurs</td></tr>
<tr><td>14</td><td>Auto skip</td></tr>
<tr><td>15</td><td>[Fault reset]</td></tr>
<tr><td>16</td><td>[Enable operation]</td></tr>
</tbody></table>
<p><strong>Control Word (0x6040:0x0)</strong>：</p>
<pre><code>+-----------------------------------------------------------+
+-----------------------------------------------------------+
Bit 15                                                  Bit 0
</code></pre>
<ul>
<li>Bit 0: Switch On</li>
<li>Bit 1: Enable Voltage</li>
<li>Bit 2: Quick Stop</li>
<li>Bit 3: Enable Operation</li>
<li>Bit 4: Operation Mode Specification</li>
<li>Bit 5: Operation Mode Specification</li>
<li>Bit 6: Operation Mode Specification</li>
<li>Bit 7: Fault Reset</li>
<li>Bit 8: Halt</li>
<li>Bit 9: Operation Mode Specification</li>
<li>Bit 10: Reserved</li>
<li>Bit 11: Reserved</li>
<li>Bit 12: Reserved</li>
<li>Bit 13: Reserved</li>
<li>Bit 14: Reserved</li>
<li>Bit 15: Reserved</li>
</ul>
<p>Operation Mode Specification:</p>
<table><thead><tr><th>OP mode</th><th>Bit 9</th><th>Bit 6</th><th>Bit 5</th><th>Bit 4</th></tr></thead><tbody>
<tr><td>PP</td><td>change on set-point</td><td>absolute/relative</td><td>change set immediately</td><td>new set-point</td></tr>
<tr><td>PV</td><td>--</td><td>--</td><td>--</td><td></td></tr>
<tr><td>TQ</td><td>--</td><td>--</td><td>--</td><td></td></tr>
<tr><td>HM</td><td>--</td><td>--</td><td>start homing</td><td></td></tr>
<tr><td>CSP</td><td>--</td><td>--</td><td>--</td><td></td></tr>
<tr><td>CSV</td><td>--</td><td>--</td><td>--</td><td></td></tr>
<tr><td>CST</td><td>--</td><td>--</td><td>--</td><td></td></tr>
</tbody></table>
<table><thead><tr><th>Commnad</th><th>bit 7</th><th>bit 3</th><th>bit 2</th><th>bit 1</th><th>bit 0</th><th>Transitions</th></tr></thead><tbody>
<tr><td>Shutdown</td><td>0</td><td>-</td><td>1</td><td>1</td><td>0</td><td>2,6,8</td></tr>
<tr><td>Switch on</td><td>0</td><td>0</td><td>1</td><td>1</td><td>1</td><td>3</td></tr>
<tr><td>Switch on + Enable operation</td><td>0</td><td>1</td><td>1</td><td>1</td><td>1</td><td>3+4</td></tr>
<tr><td>Enable operation</td><td>0</td><td>1</td><td>1</td><td>1</td><td>1</td><td>4,16</td></tr>
<tr><td>Disable voltage</td><td>0</td><td>-</td><td>-</td><td>0</td><td>-</td><td>7,9,10,12</td></tr>
<tr><td>Quick stop</td><td>0</td><td>-</td><td>0</td><td>1</td><td>-</td><td>7,10,11</td></tr>
<tr><td>Disable operation</td><td>0</td><td>0</td><td>1</td><td>1</td><td>1</td><td>5</td></tr>
<tr><td>Fault Reset</td><td>0 -&gt; 1</td><td>-</td><td>-</td><td>-</td><td>-</td><td>15</td></tr>
</tbody></table>
<p><strong>Status Word (0x6041:0x0)</strong>：</p>
<pre><code>+-----------------------------------------------------------+
+-----------------------------------------------------------+
Bit 15                                                  Bit 0
</code></pre>
<ul>
<li>Bit 0: Ready to Switch On</li>
<li>Bit 1: Switched On</li>
<li>Bit 2: Operation Enabled</li>
<li>Bit 3: Fault</li>
<li>Bit 4: Voltage Enabled</li>
<li>Bit 5: Quick Stop</li>
<li>Bit 6: Switch On Disabled</li>
<li>Bit 7: Warning</li>
<li>Bit 8: Reserved</li>
<li>Bit 9: Remote</li>
<li>Bit 10: Operation Mode Specification</li>
<li>Bit 11: Internal Limit Active</li>
<li>Bit 12: Operation Mode Specification</li>
<li>Bit 13: Operation Mode Specification</li>
<li>Bit 14: Reserved</li>
<li>Bit 15: Reserved</li>
</ul>
<p>Operation Mode Specification:</p>
<table><thead><tr><th>OP mode</th><th>Bit 13</th><th>Bit 12</th><th>Bit 10</th></tr></thead><tbody>
<tr><td>PP</td><td>following error</td><td>set-point acknowledge</td><td>target reached</td></tr>
<tr><td>PV</td><td>--</td><td>speed</td><td>target reached</td></tr>
<tr><td>TQ</td><td>--</td><td>--</td><td>target reached</td></tr>
<tr><td>HM</td><td>homing error</td><td>homing attained</td><td>target reached</td></tr>
<tr><td>CSP</td><td>following error</td><td></td><td>--</td></tr>
<tr><td>CSV</td><td>--</td><td></td><td>--</td></tr>
<tr><td>CST</td><td>--</td><td></td><td>--</td></tr>
</tbody></table>
<p>FSA State:</p>
<table><thead><tr><th>FSA State</th><th>Bit 6</th><th>Bit 5</th><th>Bit 3</th><th>Bit 2</th><th>Bit 1</th><th>Bit 0</th></tr></thead><tbody>
<tr><td>Not Ready to Switch on</td><td>0</td><td>-</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>Switch on Disabled</td><td>1</td><td>-</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>Ready To Switch On</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td></tr>
<tr><td>Switch on</td><td>0</td><td>1</td><td>0</td><td>0</td><td>1</td><td>1</td></tr>
<tr><td>Operation Enabled</td><td>0</td><td>1</td><td>0</td><td>1</td><td>1</td><td>1</td></tr>
<tr><td>Quick Stop Active</td><td>0</td><td>0</td><td>0</td><td>1</td><td>1</td><td>1</td></tr>
<tr><td>Faut Reaction Active</td><td>0</td><td>-</td><td>1</td><td>1</td><td>1</td><td>1</td></tr>
<tr><td>Fault</td><td>0</td><td>-</td><td>1</td><td>0</td><td>0</td><td>0</td></tr>
</tbody></table>
<hr />
<h4 id="drive-halt--ch-n----"><a class="header" href="#drive-halt--ch-n----"><code>+drive-halt ( ch n -- )</code></a></h4>
<p>命令 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道的馬達驅動器功能暫停。</p>
<p>此時馬達會依據 0x605D (Halt option code) 設定，暫時性的減速與停止。</p>
<h4 id="drive-homed--ch-n----"><a class="header" href="#drive-homed--ch-n----"><code>+drive-homed ( ch n -- )</code></a></h4>
<p>標記 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道的馬達驅動器已經完成回歸機械原點。</p>
<p>此狀態為主站所提供的狀態紀錄。</p>
<h4 id="pp-cosp--ch-n----"><a class="header" href="#pp-cosp--ch-n----"><code>+pp-cosp ( ch n -- )</code></a></h4>
<p>當 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道的馬達驅動器處於 PP 模式時，設定 Control Word 的 Bit 9 （Change on set-point） 為 1。</p>
<p>當 Control Word Bit 9 為 1 （Change on set-point）與 Bit 5 （change set immediately） 為 0 時，同方向運動不減速到 0 通過中繼點。</p>
<p>細部功能請參考選用驅動器的 PP 模式描述。</p>
<h4 id="pp-imt--ch-n----"><a class="header" href="#pp-imt--ch-n----"><code>+pp-imt ( ch n -- )</code></a></h4>
<p>當 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道的馬達驅動器處於 PP 模式時，設定 Control Word 的 Bit 5 （change set immediately）為 1。</p>
<p>當 Control Word 的 Bit 5 （change set immediately） 為 1 時，表示要馬達驅動器只朝向最後所接受的目標位置運動。</p>
<p>細部功能請參考選用驅動器的 PP 模式描述。</p>
<h4 id="pp-rel--ch-n----"><a class="header" href="#pp-rel--ch-n----"><code>+pp-rel ( ch n -- )</code></a></h4>
<p>當 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道的馬達驅動器處於 PP 模式時，設定 Control Word 的 Bit 6 （absolute/relative）為 1。</p>
<p>細部功能請參考選用驅動器的 PP 模式描述。當 Control Word 的 Bit 6 （absolute/relative）為 1，馬達驅動器以相對位置來處理目標位置。</p>
<h4 id="-drive-halt--ch-n----"><a class="header" href="#-drive-halt--ch-n----"><code>-drive-halt ( ch n -- )</code></a></h4>
<p>命令 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道的馬達驅動器功能繼續。</p>
<p>參考命令 <code>+drive-halt</code></p>
<h4 id="-drive-homed--ch-n----"><a class="header" href="#-drive-homed--ch-n----"><code>-drive-homed ( ch n -- )</code></a></h4>
<p>標記 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道的馬達驅動器未完成回歸機械原點。</p>
<p>此狀態為主站所提供的狀態紀錄。</p>
<h4 id="-pp-cosp--ch-n----"><a class="header" href="#-pp-cosp--ch-n----"><code>-pp-cosp ( ch n -- )</code></a></h4>
<p>當 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道的馬達驅動器處於 PP 模式時，設定 Control Word 的 Bit 9 （Change on set-point）為 0。</p>
<p>當 Control Word Bit 9 為 0 （Change on set-point）與 Bit 5 （change set immediately） 為 0 時，同方向運動減速到 0 通過中繼點。</p>
<p>細部功能請參考選用驅動器的 PP 模式描述。</p>
<h4 id="-pp-imt--ch-n----"><a class="header" href="#-pp-imt--ch-n----"><code>-pp-imt ( ch n -- )</code></a></h4>
<p>當 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道的馬達驅動器處於 PP 模式時，設定 Control Word 的 Bit 5 （change set immediately）為 0。</p>
<p>當 Control Word 的 Bit 5 （change set immediately） 為 0 時，表示要通過每一個馬達驅動器所接受的目標位置。</p>
<p>細部功能請參考選用驅動器的 PP 模式描述。</p>
<h4 id="-pp-rel--ch-n----"><a class="header" href="#-pp-rel--ch-n----"><code>-pp-rel ( ch n -- )</code></a></h4>
<p>當 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道的馬達驅動器處於 PP 模式時，設定 Control Word 的 Bit 6 （absolute/relative）為 0。</p>
<p>細部功能請參考選用驅動器的 PP 模式描述。當 Control Word 的 Bit 6 （absolute/relative）為 1，馬達驅動器以絕對位置來處理目標位置。</p>
<h4 id="drive-cw--cw-ch-n----"><a class="header" href="#drive-cw--cw-ch-n----"><code>drive-cw! ( cw ch n -- )</code></a></h4>
<p>直接設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 control word 為 <code>cw</code>。(由 PDO 設定)。</p>
<h4 id="demand-p--ch-n----pos-"><a class="header" href="#demand-p--ch-n----pos-"><code>demand-p@ ( ch n -- pos )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 demand position <code>pos</code>。</p>
<p>需要設定主站參數檔，而且該管道的馬達驅動器可以將 demand position (object 0x6062) 映射到 PDO Mapping 上。</p>
<h4 id="demand-v--ch-n----vel-"><a class="header" href="#demand-v--ch-n----vel-"><code>demand-v@ ( ch n -- vel )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 demand velocity <code>vel</code>。</p>
<p>需要設定主站參數檔，而且該管道的馬達驅動器可以將 demand velocity (object 0x606B) 映射到 PDO Mapping 上。</p>
<h4 id="drive-dins--ch-n----dins-"><a class="header" href="#drive-dins--ch-n----dins-"><code>drive-dins@ ( ch n -- dins )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的數位輸入狀態 <code>dins</code>。(由 PDO 取得資料)。</p>
<p>對應到 object 0x60FD。定義如下：</p>
<pre><code>+-----------------------------------------------------------+
+-----------------------------------------------------------+
Bit 31                                                  Bit 0
</code></pre>
<ul>
<li>Bit 0: Negative Limit</li>
<li>Bit 1: Positive Limit</li>
<li>Bit 2: Home Switch</li>
<li>Bit 3 ~ 31: 依馬達驅動器廠商定義。</li>
</ul>
<h4 id="drive-douts--douts-ch-n----"><a class="header" href="#drive-douts--douts-ch-n----"><code>drive-douts! ( douts ch n -- )</code></a></h4>
<p>使用 SDO 命令，設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的數位輸出為 <code>douts</code>。</p>
<p>對應到 object 0x60FE:0x01。定義如下：</p>
<pre><code>+-----------------------------------------------------------+
+-----------------------------------------------------------+
Bit 31                                                  Bit 0
</code></pre>
<ul>
<li>Bit 0: Brake。</li>
<li>Bit 1 ~ 31: 依馬達驅動器廠商定義。</li>
</ul>
<p>一般而言，驅動器的數位輸出是由馬達驅動器直接控制，如果需要由主站直接控制輸出，就要搭配 <code>drive-douts-mask!</code> 一起使用。</p>
<h4 id="drive-douts-mask--mask-ch-n----"><a class="header" href="#drive-douts-mask--mask-ch-n----"><code>drive-douts-mask! ( mask ch n -- )</code></a></h4>
<p>使用 SDO 命令，設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的數位輸出遮罩為 <code>mask</code>。</p>
<p>與 <code>drive-douts!</code> 一起使用。</p>
<h4 id="drive-fault--ch-n----flag-"><a class="header" href="#drive-fault--ch-n----flag-"><code>drive-fault? ( ch n -- flag )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 status word Bit 3 (fault) 的狀態 <code>flag</code>。</p>
<h4 id="drive-homed--ch-n----flag-"><a class="header" href="#drive-homed--ch-n----flag-"><code>drive-homed? ( ch n -- flag )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器是否已經回歸機械原點 <code>flag</code>。</p>
<h4 id="drive-nl--ch-n----nl-"><a class="header" href="#drive-nl--ch-n----nl-"><code>drive-nl? ( ch n -- nl )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的負向極限開關是否被觸發 <code>nl</code>。</p>
<p>其狀態來源與 <code>drive-dins@</code> 相同。</p>
<h4 id="drive-nsl--nsl-ch-n----"><a class="header" href="#drive-nsl--nsl-ch-n----"><code>drive-nsl! ( nsl ch n -- )</code></a></h4>
<p>使用 SDO 命令設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的負向軟體極限為 <code>nsl</code>。</p>
<p>對應的 Object 0x607D:0x01。</p>
<h4 id="drive-nsl--ch-n----nsl-"><a class="header" href="#drive-nsl--ch-n----nsl-"><code>drive-nsl@ ( ch n -- nsl )</code></a></h4>
<p>將 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的負向軟體極限放到堆疊上。</p>
<p>此設定值會在開機時從馬達驅動器讀回到主站。在開機後設定負向軟體極限請使用 <code>drive-nsl!</code>，這樣 SDO 命令回應的記憶體位置才會正確。</p>
<h4 id="drive-off-ch-n----"><a class="header" href="#drive-off-ch-n----"><code>drive-off (ch n -- )</code></a></h4>
<p>將 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 FSA State 切換到 Switch On Disabled。</p>
<h4 id="drive-on-ch-n----"><a class="header" href="#drive-on-ch-n----"><code>drive-on (ch n -- )</code></a></h4>
<p>將 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 FSA State 切換到 Operation Enabled。</p>
<h4 id="drive-on--ch-n----flag-"><a class="header" href="#drive-on--ch-n----flag-"><code>drive-on? ( ch n -- flag )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 FSA State 是否在 Operation Enabled <code>flag</code>。</p>
<h4 id="drive-org--ch-n----org-"><a class="header" href="#drive-org--ch-n----org-"><code>drive-org? ( ch n -- org )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 home switch 是否被觸發 <code>org</code>。</p>
<p>其狀態來源與 <code>drive-dins@</code> 相同。</p>
<h4 id="drive-pl--ch-n----pl-"><a class="header" href="#drive-pl--ch-n----pl-"><code>drive-pl? ( ch n -- pl )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的正向極限開關是否被觸發 <code>nl</code>。</p>
<p>其狀態來源與 <code>drive-dins@</code> 相同。</p>
<h4 id="drive-psl--psl-ch-n----"><a class="header" href="#drive-psl--psl-ch-n----"><code>drive-psl! ( psl ch n -- )</code></a></h4>
<p>使用 SDO 命令設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的正向軟體極限為 <code>psl</code>。</p>
<p>對應的 Object 0x607D:0x02。</p>
<h3 id="drive-psl--ch-n----psl-"><a class="header" href="#drive-psl--ch-n----psl-"><code>drive-psl@ ( ch n -- psl )</code></a></h3>
<p>將 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的正向軟體極限放到堆疊上。</p>
<p>此設定值會在開機時從馬達驅動器讀回到主站。在開機後設定正向軟體極限請使用 <code>drive-psl!</code>，這樣 SDO 命令回應的記憶體位置才會正確。</p>
<h4 id="drive-polarity--polarity-ch-n----"><a class="header" href="#drive-polarity--polarity-ch-n----"><code>drive-polarity! ( polarity ch n -- )</code></a></h4>
<p>使用 SDO 命令設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的方向定義 <code>polarity</code>。</p>
<p>對應的 Object 0x607E。</p>
<h4 id="drive-rpdo1--ch-n----r1-"><a class="header" href="#drive-rpdo1--ch-n----r1-"><code>drive-rpdo1@ ( ch n -- r1 )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器使用者規劃的第一個 Rx PDO 資料 （slave -&gt; master）<code>r1</code>。</p>
<p>需要設定主站參數檔，而且該管道的馬達驅動器可以將對應的 object 映射到 PDO Mapping 上。</p>
<h4 id="drive-rpdo2--ch-n----r2-"><a class="header" href="#drive-rpdo2--ch-n----r2-"><code>drive-rpdo2@ ( ch n -- r2 )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器使用者規劃的第二個 Rx PDO 資料 （slave -&gt; master）<code>r2</code>。</p>
<p>需要設定主站參數檔，而且該管道的馬達驅動器可以將對應的 object 映射到 PDO Mapping 上。</p>
<h4 id="drive-stop--ch-n----"><a class="header" href="#drive-stop--ch-n----"><code>drive-stop ( ch n -- )</code></a></h4>
<p>將 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 FSA State 切換到 Quick stop actived。</p>
<h4 id="drive-sw--ch-n----sw-"><a class="header" href="#drive-sw--ch-n----sw-"><code>drive-sw@ ( ch n -- sw )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 Status Word <code>sw</code>。(由 PDO 取得資料)。</p>
<h4 id="drive-vmax--vmax-ch-n----"><a class="header" href="#drive-vmax--vmax-ch-n----"><code>drive-vmax! ( vmax ch n -- )</code></a></h4>
<p>使用 SDO 命令設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的最高速度 <code>vmax</code>。</p>
<p>對應的 Object 0x6080:0x01。</p>
<h4 id="drive-wpdo1--w1-ch-n----"><a class="header" href="#drive-wpdo1--w1-ch-n----"><code>drive-wpdo1! ( w1 ch n -- )</code></a></h4>
<p>設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器使用者規劃的第一個 Tx PDO 資料 （master -&gt; slave）<code>w1</code>。</p>
<p>需要設定主站參數檔，而且該管道的馬達驅動器可以將對應的 object 映射到 PDO Mapping 上。</p>
<h4 id="drive-wpdo1--ch-n----w1-"><a class="header" href="#drive-wpdo1--ch-n----w1-"><code>drive-wpdo1@ ( ch n -- w1 )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器使用者規劃的第一個 Tx PDO 資料 （master -&gt; slave）<code>w1</code>。</p>
<p>需要設定主站參數檔，而且該管道的馬達驅動器可以將對應的 object 映射到 PDO Mapping 上。</p>
<h4 id="drive-wpdo2--w2-ch-n----"><a class="header" href="#drive-wpdo2--w2-ch-n----"><code>drive-wpdo2! ( w2 ch n -- )</code></a></h4>
<p>設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器使用者規劃的第二個 Tx PDO 資料 （master -&gt; slave）<code>w2</code>。</p>
<p>需要設定主站參數檔，而且該管道的馬達驅動器可以將對應的 object 映射到 PDO Mapping 上。</p>
<h4 id="drive-wpdo2--ch-n----w2-"><a class="header" href="#drive-wpdo2--ch-n----w2-"><code>drive-wpdo2@ ( ch n -- w2 )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器使用者規劃的第二個 Tx PDO 資料 （master -&gt; slave）<code>w2</code>。</p>
<p>需要設定主站參數檔，而且該管道的馬達驅動器可以將對應的 object 映射到 PDO Mapping 上。</p>
<h4 id="go--ch-n----"><a class="header" href="#go--ch-n----"><code>go ( ch n -- )</code></a></h4>
<p>設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器 Control Word 的 Bit 4 為 1。</p>
<p>該管道馬達驅動器在 PP 模式時為 new set-point，在 HM 模式時為 start homing。當主站接受到該管道的回應訊息時，會自動將 Control Word 的 Bit 4 設定為 0。</p>
<h4 id="homing-a--acceleration-ch-n----"><a class="header" href="#homing-a--acceleration-ch-n----"><code>homing-a! ( acceleration ch n -- )</code></a></h4>
<p>使用 SDO 指令設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 homing acceleration <code>acceleration</code>。</p>
<p>對應的 Object 為 0x609A。要留意馬達驅動器的設定單位。</p>
<h4 id="homing-method--method-ch-n----"><a class="header" href="#homing-method--method-ch-n----"><code>homing-method! ( method ch n -- )</code></a></h4>
<p>使用 SDO 指令設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 homing method <code>method</code>。</p>
<p>對應的 Object 為 0x6098。</p>
<h4 id="homing-v1--v1-ch-n----"><a class="header" href="#homing-v1--v1-ch-n----"><code>homing-v1! ( v1 ch n -- )</code></a></h4>
<p>使用 SDO 指令設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 homing speed for switch <code>v1</code>。</p>
<p>對應的 Object 為 0x6099:0x01。要留意馬達驅動器的設定單位。</p>
<h4 id="homing-v2--v2-ch-n----"><a class="header" href="#homing-v2--v2-ch-n----"><code>homing-v2! ( v2 ch n -- )</code></a></h4>
<p>使用 SDO 指令設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 homing speed for zero <code>v2</code>。</p>
<p>對應的 Object 為 0x6099:0x02。要留意馬達驅動器的設定單位。</p>
<h4 id="op-mode--mode-ch-n----"><a class="header" href="#op-mode--mode-ch-n----"><code>op-mode! ( mode ch n -- )</code></a></h4>
<p>使用 SDO 指令設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的操作模式 <code>mode</code>。</p>
<p>對應的 Object 為 0x6060。</p>
<p>目前有支援的 mode 如下：</p>
<pre><code>1: PP
3: PV
4: TQ
6: HM
8: CSP
9: CSV
10: CST
</code></pre>
<p>也有已經定義好的模式代號命令：</p>
<pre><code>: pp ( -- mode ) 1 ;
: pv ( -- mode ) 3 ;
: tq ( -- mode ) 4 ;
: hm ( -- mode ) 6 ;
: csp ( -- mode ) 8 ;
: csv ( -- mode ) 9 ;
: cst ( -- mode ) 10 ;
</code></pre>
<p>命令範例:</p>
<pre><code>1  1 1 op-mode!  \ 將 EtherCAT 從站編號 1 第 1 管道馬達驅動器切換為 PP 模式
pp 1 1 op-mode!  \ 將 EtherCAT 從站編號 1 第 1 管道馬達驅動器切換為 PP 模式
3  1 1 op-mode!  \ 將 EtherCAT 從站編號 1 第 1 管道馬達驅動器切換為 PV 模式
pv 1 1 op-mode!  \ 將 EtherCAT 從站編號 1 第 1 管道馬達驅動器切換為 PV 模式
4  1 1 op-mode!  \ 將 EtherCAT 從站編號 1 第 1 管道馬達驅動器切換為 TQ 模式
tq 1 1 op-mode!  \ 將 EtherCAT 從站編號 1 第 1 管道馬達驅動器切換為 TQ 模式
6  1 1 op-mode!  \ 將 EtherCAT 從站編號 1 第 1 管道馬達驅動器切換為 HM 模式
hm 1 1 op-mode!  \ 將 EtherCAT 從站編號 1 第 1 管道馬達驅動器切換為 HM 模式
8   1 1 op-mode! \ 將 EtherCAT 從站編號 1 第 1 管道馬達驅動器切換為 CSP 模式
csp 1 1 op-mode! \ 將 EtherCAT 從站編號 1 第 1 管道馬達驅動器切換為 CSP 模式
9   1 1 op-mode! \ 將 EtherCAT 從站編號 1 第 1 管道馬達驅動器切換為 CSV 模式
csv 1 1 op-mode! \ 將 EtherCAT 從站編號 1 第 1 管道馬達驅動器切換為 CSV 模式
10  1 1 op-mode! \ 將 EtherCAT 從站編號 1 第 1 管道馬達驅動器切換為 CST 模式
cst 1 1 op-mode! \ 將 EtherCAT 從站編號 1 第 1 管道馬達驅動器切換為 CST 模式
</code></pre>
<h4 id="pds-goal--goal-ch-n----"><a class="header" href="#pds-goal--goal-ch-n----"><code>pds-goal! ( goal ch n -- )</code></a></h4>
<p>切換 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 FSA State <code>goal</code>。主站會依據 FSA State 自動設定 Control Word。</p>
<p>可以切換的 FSA state of PDS 如下：</p>
<pre><code>: switch-on-disabled ( -- goal ) 1 ;
: ready-to-switch-on ( -- goal ) 2 ;
: switched-on        ( -- goal ) 3 ;
: operation-enabled  ( -- goal ) 4 ;
: quick-stop-active  ( -- goal ) 5 ;
</code></pre>
<p><code>drive-on</code>, <code>drive-on</code> 與 <code>drive-stop</code> 命令就是以 <code>pds-goal</code> 命令組合而成：</p>
<pre><code>: drive-on ( ch n -- )
    operation-enabled -rot pds-goal! ;

: drive-off ( ch n -- )
    switch-on-disabled -rot pds-goal! ;

: drive-stop ( ch n -- )
    quick-stop-active -rot pds-goal! ;
</code></pre>
<h4 id="profile-a1--a1-ch-n----"><a class="header" href="#profile-a1--a1-ch-n----"><code>profile-a1! ( a1 ch n -- )</code></a></h4>
<p>使用 SDO 指令設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 profile acceleration <code>a1</code>。</p>
<p>對應的 Object 為 0x6083。在 PP 與 PV 模式時會使用到此加速度進行位置或是速度規劃，要留意馬達驅動器的設定單位。</p>
<h4 id="profile-a2--a2-ch-n----"><a class="header" href="#profile-a2--a2-ch-n----"><code>profile-a2! ( a2 ch n -- )</code></a></h4>
<p>使用 SDO 指令設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 profile deceleration <code>a2</code>。</p>
<p>對應的 Object 為 0x6084。在 PP 與 PV 模式時會使用到此減速進行位置或是速度規劃，要留意馬達驅動器的設定單位。</p>
<h4 id="profile-v--vel-ch-n----"><a class="header" href="#profile-v--vel-ch-n----"><code>profile-v! ( vel ch n -- )</code></a></h4>
<p>使用 SDO 指令設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 profile velocity <code>vel</code>。</p>
<p>對應的 Object 為 0x6081。在 PP 模式時會使用速度進行位置與速度規劃，要留意馬達驅動器的設定單位。</p>
<h4 id="real-p--ch-n----pos-"><a class="header" href="#real-p--ch-n----pos-"><code>real-p@ ( ch n -- pos )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的真實位置 <code>pos</code>。(由 PDO 取得資料)。</p>
<p>對應的 Object 為 0x6064。通常單位是脈波數。</p>
<h4 id="real-tq--ch-n----tq-"><a class="header" href="#real-tq--ch-n----tq-"><code>real-tq@ ( ch n -- tq )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的真實扭力輸出 <code>tq</code>。(由 PDO 取得資料)。</p>
<p>需要設定主站參數檔，而且該管道的馬達驅動器可以將 real torque (object 0x6077) 映射到 PDO Mapping 上。通常單位是 0.1 %。</p>
<h4 id="real-v--ch-n----vel-"><a class="header" href="#real-v--ch-n----vel-"><code>real-v@ ( ch n -- vel )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的真實速度 <code>vel</code>。(由 PDO 取得資料)。</p>
<p>需要設定主站參數檔，而且該管道的馬達驅動器可以將 real velocity (object 0x606C) 映射到 PDO Mapping 上。單位有可能是 pulse/s 或是 0.1 rpm。</p>
<h4 id="reset-fault--ch-n----"><a class="header" href="#reset-fault--ch-n----"><code>reset-fault ( ch n -- )</code></a></h4>
<p>當 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器處於 Fault of FAS State 時，將該管道馬達驅動器切換到 Switch on Disabled 的狀態。主站會自動設定對應的 Control Word。</p>
<h4 id="target-p--pos-ch-n----"><a class="header" href="#target-p--pos-ch-n----"><code>target-p! ( pos ch n -- )</code></a></h4>
<p>設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的目標位置 <code>pos</code>。(由 PDO 設定位置)。</p>
<p>對應的 Object 為 0x607A。通常單位是脈波數。</p>
<h4 id="target-p--ch-n----pos-"><a class="header" href="#target-p--ch-n----pos-"><code>target-p@ ( ch n -- pos )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的目標位置 <code>pos</code>。</p>
<h4 id="target-reached--ch-n----flag-"><a class="header" href="#target-reached--ch-n----flag-"><code>target-reached? ( ch n -- flag )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 Status Word Bit 10 (target reached) 是否為 1 。</p>
<p>其狀態來源與 <code>drive-sw@</code> 相同。</p>
<h4 id="target-v--vel-ch-n----"><a class="header" href="#target-v--vel-ch-n----"><code>target-v! ( vel ch n -- )</code></a></h4>
<p>使用 SDO 指令設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的目標速度 <code>v</code>。</p>
<p>對應的 Object 為 0x60FF。單位有可能是 pulse/s 或是 0.1 rpm。</p>
<p>此命令只適合在 PV 模式下使用，如果是 CSV 模式要設定目標速度則是要使用 <code>drive-wpdo1!</code> 或是 <code>drive-wpdo2!</code>。</p>
<h4 id="tq-slope--slope-ch-n----"><a class="header" href="#tq-slope--slope-ch-n----"><code>tq-slope! ( slope ch n -- )</code></a></h4>
<p>使用 SDO 指令設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的扭力輸出變化率 <code>slope</code>。</p>
<p>對應的 Object 為 0x6087。通常單位是 0.1%/s。</p>
<p>在 TQ 模式下，使用此設定值進行扭力輸出規劃，通常會搭配 <code>drive-vmax!</code>一起使用，避免馬達扭力輸出未到達目標時，其運動速度過快。</p>
<h4 id="until-drive-on--ch-n----"><a class="header" href="#until-drive-on--ch-n----"><code>until-drive-on ( ch n -- )</code></a></h4>
<p>等待 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 FSA State 到達 Operation Enabled。</p>
<p>因此命令內含有 <code>pause</code>，所以只適合用於 Background Task。</p>
<p>此命令相當於:</p>
<pre><code>: until-drive-on ( ch n -- )
    begin
        over over drive-on? not
    while
        pause
    repeat
    drop drop ;
</code></pre>
<h4 id="until-no-fault--ch-n----"><a class="header" href="#until-no-fault--ch-n----"><code>until-no-fault ( ch n -- )</code></a></h4>
<p>等待 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 Status Word Bit 3 (Fault) 為 0。</p>
<p>因此命令內含有 <code>pause</code>，所以只適合用於 Background Task。</p>
<p>相當於 </p>
<pre><code>: until-no-fault ( channel slave -- )     
    pause pause pause pause pause pause \ 確保收到驅動器最新的 status word
    begin
        over over drive-fault?
    while
        pause
    repeat
    drop drop ; 
</code></pre>
<h4 id="until-target-reached--ch-n----"><a class="header" href="#until-target-reached--ch-n----"><code>until-target-reached ( ch n -- )</code></a></h4>
<p>等待 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 Status Word Bit 10 (target reached) 為 1。</p>
<p>因此命令內含有 <code>pause</code>，所以只適合用於 Background Task。</p>
<p>此命令相當於:</p>
<pre><code>: until-target-reached ( channel slave -- )
    pause pause pause pause pause pause \ 確保收到驅動器最新的 status word
    begin
        over over target-reached? not
    while
        pause
    repeat
    drop drop
;
</code></pre>
<h4 id="v-ofs--ofs-ch-n----"><a class="header" href="#v-ofs--ofs-ch-n----"><code>v-ofs! ( ofs ch n -- )</code></a></h4>
<p>設定 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 Velocity Offset <code>ofs</code>。</p>
<p>需要設定主站參數檔，而且該管道的馬達驅動器可以將 Velocity Offset (object 0x60B1) 映射到 PDO Mapping 上。</p>
<p>此一命令通常用於 CSP 或是 CSV 模式下，可以在馬達驅動器內的速度控制迴路額外調整速度目標值。單位通常是 pulse/s 或是 0.1 rpm。</p>
<h4 id="v-ofs---ch-n----ofs-"><a class="header" href="#v-ofs---ch-n----ofs-"><code>v-ofs@  ( ch n -- ofs )</code></a></h4>
<p>取得 EtherCAT 從站編號 <code>n</code> 第 <code>ch</code> 管道馬達驅動器的 Velocity Offset <code>ofs</code>。</p>
<p>需要設定主站參數檔，而且該管道的馬達驅動器可以將 Velocity Offset (object 0x60B1) 映射到 PDO Mapping 上。</p>
<h4 id="pp-test-範例"><a class="header" href="#pp-test-範例">PP-TEST 範例</a></h4>
<p>使用 EtherCAT 從站編號 1 第 1 管道的馬達驅動器。</p>
<pre><code>: pp-test
    pp 1 1 op-mode!          \ 切換到 PP Mode
    until-no-requests        \ 等待 op-mode! 命令實際設定到驅動器
    1 1 reset-fault          \ 解除驅動器異警
    1 1 until-no-fault       \ 等待解除驅動器異警完成
    1 1 drive-on             \ Drive On
    1 1 until-drive-on       \ 等待 Drive on 程序完成
    1000 1 1 target-p!       \ Set target position to 1000
    1 1 go                   \ New set-point
    1 1 until-target-reached \ 等待到達目標點
;

deploy pp-test ;deploy       \ 在 Background Task 執行 pp-test
</code></pre>
<h4 id="本節指令集"><a class="header" href="#本節指令集">本節指令集</a></h4>
<table><thead><tr><th>指令</th><th>堆疊效果</th></tr></thead><tbody>
<tr><td>+drive-halt</td><td>( ch n -- )</td></tr>
<tr><td>+drive-homed</td><td>( ch n -- )</td></tr>
<tr><td>+pp-cosp</td><td>( ch n -- )</td></tr>
<tr><td>+pp-imt</td><td>( ch n -- )</td></tr>
<tr><td>+pp-rel</td><td>( ch n -- )</td></tr>
<tr><td>-drive-halt</td><td>( ch n -- )</td></tr>
<tr><td>-drive-homed</td><td>( ch n -- )</td></tr>
<tr><td>-pp-cosp</td><td>( ch n -- )</td></tr>
<tr><td>-pp-imt</td><td>( ch n -- )</td></tr>
<tr><td>-pp-rel</td><td>( ch n -- )</td></tr>
<tr><td>csp</td><td>( -- 8 )</td></tr>
<tr><td>cst</td><td>( -- 10 )</td></tr>
<tr><td>csv</td><td>( -- 9 )</td></tr>
<tr><td>drive-cw!</td><td>( cw ch n -- )</td></tr>
<tr><td>demand-p@</td><td>( ch n -- pos )</td></tr>
<tr><td>demand-v@</td><td>( ch n -- vel )</td></tr>
<tr><td>drive-dins@</td><td>( ch n -- dins )</td></tr>
<tr><td>drive-douts!</td><td>( douts ch n -- )</td></tr>
<tr><td>drive-douts-mask!</td><td>( mask ch n -- )</td></tr>
<tr><td>drive-fault?</td><td>( ch n -- flag )</td></tr>
<tr><td>drive-homed?</td><td>( ch n -- flag )</td></tr>
<tr><td>drive-nl?</td><td>( ch n -- nl )</td></tr>
<tr><td>drive-nsl!</td><td>( nsl ch n -- )</td></tr>
<tr><td>drive-nsl@</td><td>( ch n -- nsl )</td></tr>
<tr><td>drive-off</td><td>( ch n -- )</td></tr>
<tr><td>drive-on</td><td>( ch n -- )</td></tr>
<tr><td>drive-on?</td><td>( ch n -- flag )</td></tr>
<tr><td>drive-org?</td><td>( ch n -- org )</td></tr>
<tr><td>drive-pl?</td><td>( ch n -- pl )</td></tr>
<tr><td>drive-psl!</td><td>( psl ch n -- )</td></tr>
<tr><td>drive-psl@</td><td>( ch n -- psl )</td></tr>
<tr><td>drive-polarity!</td><td>( polarity ch n -- )</td></tr>
<tr><td>drive-rpdo1@</td><td>( ch n -- r1 )</td></tr>
<tr><td>drive-rpdo2@</td><td>( ch n -- r2 )</td></tr>
<tr><td>drive-stop</td><td>( ch n -- )</td></tr>
<tr><td>drive-sw@</td><td>( ch n -- sw )</td></tr>
<tr><td>drive-vmax!</td><td>( vmax ch n -- )</td></tr>
<tr><td>drive-wpdo1!</td><td>( w1 ch n -- )</td></tr>
<tr><td>drive-wpdo1@</td><td>( ch n -- w1 )</td></tr>
<tr><td>drive-wpdo2!</td><td>( w2 ch n -- )</td></tr>
<tr><td>drive-wpdo2@</td><td>( ch n -- w2 )</td></tr>
<tr><td>go</td><td>( ch n -- )</td></tr>
<tr><td>hm</td><td>( -- 6 )</td></tr>
<tr><td>homing-a!</td><td>( acc ch n -- )</td></tr>
<tr><td>homing-method!</td><td>( method ch n -- )</td></tr>
<tr><td>homing-v1!</td><td>( v1 ch n -- )</td></tr>
<tr><td>homing-v2!</td><td>( v2 ch n -- )</td></tr>
<tr><td>op-mode!</td><td>( mode ch n -- )</td></tr>
<tr><td>pds-goal!</td><td>( goal ch n -- )</td></tr>
<tr><td>pp</td><td>( -- 1 )</td></tr>
<tr><td>profile-a1!</td><td>( a1 ch n -- )</td></tr>
<tr><td>profile-a2!</td><td>( a2 ch n -- )</td></tr>
<tr><td>profile-v!</td><td>( vel ch n -- )</td></tr>
<tr><td>pv</td><td>( -- 3 )</td></tr>
<tr><td>real-p@</td><td>( ch n -- pos )</td></tr>
<tr><td>real-tq@</td><td>( ch n -- tq )</td></tr>
<tr><td>real-v@</td><td>( ch n -- vel )</td></tr>
<tr><td>reset-fault</td><td>( ch n -- )</td></tr>
<tr><td>target-p!</td><td>( pos ch n -- )</td></tr>
<tr><td>target-p@</td><td>( ch n -- pos )</td></tr>
<tr><td>target-reached?</td><td>( channel n -- flag )</td></tr>
<tr><td>target-v!</td><td>( vel ch n -- )</td></tr>
<tr><td>tq</td><td>( -- 4 )</td></tr>
<tr><td>tq-slope!</td><td>( slope ch n -- )</td></tr>
<tr><td>until-drive-on</td><td>( ch n -- )</td></tr>
<tr><td>until-no-fault</td><td>( ch n -- )</td></tr>
<tr><td>until-target-reached</td><td>( ch n -- )</td></tr>
<tr><td>v-ofs!</td><td>( ofs ch n -- )</td></tr>
<tr><td>v-ofs@</td><td>( ch n -- ofs )</td></tr>
</tbody></table>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="ethercat-primitives.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="ethercat-io-primitives.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="ethercat-primitives.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="ethercat-io-primitives.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            var socket = new WebSocket("ws://localhost:3000/__livereload");
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
